<script>
  const startBtn = document.getElementById('startBtn');
  const resetBtn = document.getElementById('resetBtn');
  const playersArea = document.getElementById('playersArea');
  const status = document.getElementById('status');
  const numPlayersInput = document.getElementById('numPlayers');
  const numImpostorsInput = document.getElementById('numImpostors');

  function cardImageUrl(slug){
    return `https://cdn.royaleapi.com/static/img/cards-150/${slug}.png`;
  }

  function shuffle(array){
    for(let i=array.length-1;i>0;i--){
      const j=Math.floor(Math.random()*(i+1));
      [array[i],array[j]]=[array[j],array[i]];
    }
  }

  function startGame(){
    const numPlayers = parseInt(numPlayersInput.value,10);
    let numImpostors = parseInt(numImpostorsInput.value,10);
    if(isNaN(numPlayers) || numPlayers<4 || numPlayers>15){ alert('Set a number of players between 4 and 15.'); return; }
    if(isNaN(numImpostors) || numImpostors<0) numImpostors=0;
    if(numImpostors>2) numImpostors=2;
    if(numImpostors>=numPlayers) numImpostors=1;

    const pool = [...allCards];
    shuffle(pool);
    const chosen = pool[0];

    const indices = [...Array(numPlayers).keys()];
    shuffle(indices);
    const impostorIndices = indices.slice(0,numImpostors);

    playersArea.innerHTML='';
    let currentPlayer = 0;
    let revealed = false;

    for(let i=0;i<numPlayers;i++){
      const div = document.createElement('div');
      div.className='player';
      div.innerHTML = `<div><strong>Player ${i+1}</strong></div>`;

      const roleDiv = document.createElement('div');
      roleDiv.className = 'role hidden';
      const isImpostor = impostorIndices.includes(i);

      // Clique
      roleDiv.addEventListener('click', ()=>{
        if(i !== currentPlayer) return; // s√≥ o jogador actual pode clicar

        if(revealed){
          // fecha carta
          roleDiv.classList.add('hidden');
          roleDiv.classList.remove('revealed');
          roleDiv.innerHTML = '';
          revealed = false;
          currentPlayer++;
          if(currentPlayer < numPlayers){
            status.textContent = `Player ${currentPlayer + 1}, it's your turn.`;
          } else {
            status.textContent = `All players have seen their roles.`;
          }
          return;
        }

        // mostra papel
        roleDiv.classList.remove('hidden');
        roleDiv.classList.add('revealed');

        if(isImpostor){
          roleDiv.innerHTML = `<strong>IMPOSTOR</strong><br><small>You have no card. Bluff!</small>`;
        } else {
          const img = document.createElement('img');
          img.className = 'card-image';
          img.alt = chosen.name;
          img.src = cardImageUrl(chosen.slug);
          img.onerror = ()=>{ img.style.display='none'; };
          roleDiv.innerHTML = `<strong>${chosen.name}</strong>`;
          roleDiv.appendChild(img);
        }

        revealed = true;
      });

      div.appendChild(roleDiv);
      playersArea.appendChild(div);
    }

    status.textContent = `Player 1, it's your turn.`;
  }

  startBtn.addEventListener('click', startGame);
  resetBtn.addEventListener('click', ()=>{
    playersArea.innerHTML='';
    status.textContent='Ready. Adjust the options and click "Start game".';
  });
</script>




